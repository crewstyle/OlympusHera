/*!
 * hera.maps.js v2.0.0
 * https://github.com/crewstyle/OlympusHera
 *
 * This plugin change dynamically the maps preview.
 *
 * Example of JS:
 *      $('.maps').heraMaps({
 *          enable: 'enable',                           //selected class for reload button
 *          id: 'map-id',                               //container's Leaflet id
 *          inputs: ':input',                           //fields to get all configurations
 *          leafletid: 'leaflet-map-id',                //id used by Leaflet plugin
 *          map: '.maps',                               //map's container
 *          modal: '#modal-maps',                       //modal block ID
 *          reload: 'a.reload',                         //reload button
 *          updatebutton: 'a.get-maps'                  //add social network button
 *      });
 *
 * Example of HTML:
 *      --
 *
 * Copyright 2016 Achraf Chouk
 * Achraf Chouk (https://github.com/crewstyle)
 */
!function(a){"use strict";var b=function(b,c){var d=this;d.$el=b,d.options=c,d.$modal=a(d.options.modal),d.$map=d.$el.find(d.options.map),d.$reload=d.$modal.find(d.options.reload),d.icon="http://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/images/marker-icon.png",d.map_init(),d.$el.find(d.options.updatebutton).on("click",a.proxy(d.open_modal,d)),d.$reload.on("click",a.proxy(d.map_reload,d))};b.prototype.address=null,b.prototype.icon=null,b.prototype.L=null,b.prototype.lat=48.88249,b.prototype.layer=null,b.prototype.lng=2.371027,b.prototype.map=null,b.prototype.marker=null,b.prototype.options=null,b.prototype.zoom=null,b.prototype.$el=null,b.prototype.$map=null,b.prototype.$modal=null,b.prototype.$reload=null,b.prototype.open_modal=function(a){a.preventDefault();var b=this;b.$modal.heraModal({backdrop:".olz-modal-backdrop"})},b.prototype.get_datum=function(){var a=this,b=a.$modal,c=a.options.id;return a.address=b.find("#"+c+"-address").val(),a.zoom=parseInt(b.find("#"+c+"-zoom").val()),{address:a.address,width:b.find("#"+c+"-width").val(),height:b.find("#"+c+"-height").val(),zoom:a.zoom,type:b.find("#"+c+"-type").val(),dragndrop:b.find("#"+c+"-options-dragndrop").is(":checked"),streetview:b.find("#"+c+"-options-streetview").is(":checked"),zoomcontrol:b.find("#"+c+"-options-zoomcontrol").is(":checked"),mapcontrol:b.find("#"+c+"-options-mapcontrol").is(":checked"),scalecontrol:b.find("#"+c+"-options-scalecontrol").is(":checked"),pancontrol:b.find("#"+c+"-options-pancontrol").is(":checked"),rotatecontrol:b.find("#"+c+"-options-rotatecontrol").is(":checked"),rotatecontroloptions:b.find("#"+c+"-options-rotatecontroloptions").is(":checked"),scrollwheel:b.find("#"+c+"-options-scrollwheel").is(":checked"),overviewmapcontrol:b.find("#"+c+"-options-overviewmapcontrol").is(":checked"),overviewmapcontroloptions:b.find("#"+c+"-options-overviewmapcontroloptions").is(":checked")}},b.prototype.map_init=function(){var a=this;"undefined"!=typeof L&&null!==L&&(a.L=L,a.map=L.map(a.options.leafletid).setView([a.lat,a.lng],14),a.map_refresh())},b.prototype.map_marker=function(){var a=this;a.marker&&a.map.removeLayer(a.marker);var b=a.L.icon({iconUrl:a.icon});a.marker=a.L.marker([a.lat,a.lng],{icon:b}).addTo(a.map),a.map.setView([a.lat,a.lng],a.zoom)},b.prototype.map_refresh=function(){var a=this,b='Built with â™¥ by <a href="https://github.com/crewstyle/" target="_blank">Achraf Chouk</a> ~ &copy; <a href="http://osm.org/copyright" target="_blank">OpenStreetMap</a> contributors',c=a.get_datum();a.$map.css({height:c.height}),a.map.invalidateSize(),a.layer||(a.layer={Grayscale:a.L.tileLayer("http://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",{id:"tto.map-grayscale",attribution:b}),Watercolor:a.L.tileLayer("http://stamen-tiles-{s}.a.ssl.fastly.net/watercolor/{z}/{x}/{y}.png",{id:"tto.map-watercolor",attribution:b,ext:"png"}),Blackcolor:a.L.tileLayer("http://{s}.tile.stamen.com/toner/{z}/{x}/{y}.png",{id:"tto.map-black",attribution:b})},a.L.control.layers(a.layer).addTo(a.map),a.layer.Grayscale.addTo(a.map)),c.scrollwheel?a.map.scrollWheelZoom.enable():a.map.scrollWheelZoom.disable(),a.map_marker(),a.map_remake()},b.prototype.map_reload=function(a){a.preventDefault();var b=this;b.map_refresh(),b.$modal.find("a.close").click()},b.prototype.map_remake=function(){var b=this,c=encodeURIComponent(b.address);""!==c&&a.ajax({url:"https://maps.googleapis.com/maps/api/geocode/json?address="+c,dataType:"json",success:function(a){"OK"===a.status&&(b.lat=a.results[0].geometry.location.lat,b.lng=a.results[0].geometry.location.lng,b.address=a.results[0].formatted_address,b.$modal.find("#"+b.options.id+"-address").val(b.address),b.map_marker())}})};var c={init:function(c){if(!this.length)return!1;var d={enable:"enable",id:"map-id",inputs:":input",leafletid:"leaflet-id",map:".maps",modal:"#modal-maps",reload:"a.reload",updatebutton:"a.get-maps"};return this.each(function(){c&&a.extend(d,c),new b(a(this),d)})},update:function(){},destroy:function(){}};a.fn.heraMaps=function(b){return c[b]?c[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?(a.error("Method "+b+" does not exist on heraMaps"),!1):c.init.apply(this,arguments)}}(window.jQuery);